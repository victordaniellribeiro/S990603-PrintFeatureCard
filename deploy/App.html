<!DOCTYPE html>
<html>
<head>
    <title>PrintFeatureCards</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                !function(){var t=window.Ext4||window.Ext;t.define("Rally.apps.printcards.PrintCard",{extend:"Ext.Component",alias:"widget.printcard",tpl:t.create("Ext.XTemplate",'<tpl><div class="artifact"><div class="card-header"><span class="formattedid">{FormattedID}{[this.getParentID(values)]}</span><span class="owner">{[this.getOwnerImage(values)]}</span><span class="ownerText">{[this.getOwnerName(values)]}</span></div><div class="content"><div class="name">{Name}</div><div class="description">{Description}</div></div><span class="preliminaryestimate">{[this.getPreliminaryEstimate(values)]}</span><span class="planestimate">{[this.getEstimate(values)]}</span></div></tpl>',{getOwnerImage:function(t){return t.Owner&&'<img src="'+Rally.util.User.getProfileImageUrl(40,t.Owner._ref)+'"/>'||""},getOwnerName:function(t){return t.Owner&&t.Owner._refObjectName||"No Owner"},getParentID:function(t){return t.WorkProduct&&":"+t.WorkProduct.FormattedID||""},getPreliminaryEstimate:function(t){return t.PreliminaryEstimate&&t.PreliminaryEstimate.Name||"None"},getEstimate:function(t){return t.Estimate||t.LeafStoryPlanEstimateTotal||"None"}})}),t.define("Rally.apps.printcards.printstorycards.PrintStoryCardsApp",{extend:"Rally.app.TimeboxScopedApp",alias:"widget.printstorycards",requires:["Rally.data.wsapi.Store","Rally.apps.printcards.PrintCard","Rally.app.plugin.Print"],plugins:[{ptype:"rallyappprinting"}],helpId:241,componentCls:"printcards",scopeType:"release",autoScroll:!1,launch:function(){this.add({xtype:"container",itemId:"cards",autoScroll:!0,height:"100%"}),this.callParent(arguments)},onScopeChange:function(t){this.down("#cards").getEl().setHTML(""),this._loadStories(t)},_loadStories:function(e){t.create("Rally.data.wsapi.Store",{context:this.getContext().getDataContext(),autoLoad:!0,model:t.identityFn("PortfolioItem/Feature"),fetch:["FormattedID","Name","Owner","Description","LeafStoryPlanEstimateTotal","PreliminaryEstimate"],limit:e.getRecord()?200:50,listeners:{load:this._onStoriesLoaded,scope:this},filters:[e.getQueryFilter()]})},_onStoriesLoaded:function(e,a){var i="";_.each(a,function(e,a){i+=t.create("Rally.apps.printcards.PrintCard").tpl.apply(e.data),a%4==3&&(i+='<div class="pb"></div>')},this),t.DomHelper.insertHtml("beforeEnd",this.down("#cards").getEl().dom,i),Rally.BrowserTest&&Rally.BrowserTest.publishComponentReady(this)},getOptions:function(){return[{text:"Print",handler:this._onButtonPressed,scope:this}]},_onButtonPressed:function(){options="toolbar=1,menubar=1,scrollbars=yes,scrolling=yes,resizable=yes,width=1000,height=500";var t=window.open("","",options),e=t.document,a=this.down("#cards");e.write('<html><head><style type="text/css"> .printcards{margin:5px;width:100%;height:100%}.printcards html{background-color:#fff;color:#000;font:14pt / 1.26;margin:0;padding:0}.printcards .header{margin:5px}.printcards .description{float:left;font:12pt NotoSans, Helvetica, Arial;margin:0.25em auto 0 auto;padding-left:1.0em;padding-right:1.0em;overflow-y:hidden;width:100%;word-wrap:break-word}.printcards .card-header{border:1px;border-bottom-style:solid;display:table-cell;height:40px;vertical-align:middle;width:4.3in}.printcards .name{font:28px ProximaNovaBold, Helvetica, Arial;padding-top:0.5em;text-align:center}.printcards .owner{float:right;height:40px}.printcards .ownerText{float:right;font:14pt / 1.26 NotoSans,Helvetica,Arial;margin-right:0.3em;margin-top:0.3em}.printcards .formattedid{float:left;font:14pt / 1.26 NotoSans,Helvetica,Arial;margin-left:0.25em;margin-top:0.3em}.printcards .planestimate{bottom:0.5em;position:absolute;right:0.5em}.printcards .content{height:2.4in;overflow:hidden;width:4.3in;color:black;padding-left:4px;padding-right:8px}.printcards body{background-color:#fff;margin:0;padding:0}.printcards .cb{clear:both}.printcards .artifact{background-color:#fff;border:2px solid #000;float:left;height:3.2in;margin:0.1in 0.1in 0.1in 0.1in;position:relative;overflow:hidden;width:4.3in}.print-page .printcards{width:920px !important;height:100% !important;overflow:hidden !important}.print-page .printcards .header{display:none}@media print{.printcards .pb{page-break-after:always;clear:both}} </style><title>Print Features</title>'),e.write('</head><body class="printcards">'),e.write("<p>My Grid: Print Features</p><br />"),e.write(a.getEl().dom.innerHTML),e.write("</body></html>"),e.close(),this._injectCSS(t),t.print()},_injectCSS:function(e){t.each(t.query("link"),function(t){this._injectContent("","link",{rel:"stylesheet",href:t.href,type:"text/css"},e.document.getElementsByTagName("head")[0],e)},this)},_injectContent:function(e,a,i,r,n){a=a||"div",r=r||n.document.getElementsByTagName("body")[0];var o=n.document.createElement(a);return t.Object.each(i,function(t,e){"class"===t?o.className=e:o.setAttribute(t,e)}),e&&(o.innerHTML=e),r.appendChild(o)}})}();

            Rally.launchApp('Rally.apps.printcards.printstorycards.PrintStoryCardsApp', {
                name:"PrintFeatureCards",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        .printcards{margin:5px;width:100%;height:100%}.printcards html{background-color:#fff;color:#000;font:14pt / 1.26;margin:0;padding:0}.printcards .header{margin:5px}.printcards .description{float:left;font:12pt NotoSans, Helvetica, Arial;margin:0.25em auto 0 auto;padding-left:1.0em;padding-right:1.0em;overflow-y:hidden;width:100%;word-wrap:break-word}.printcards .card-header{border:1px;border-bottom-style:solid;display:table-cell;height:40px;vertical-align:middle;width:4.3in}.printcards .name{font:28px ProximaNovaBold, Helvetica, Arial;padding-top:0.5em;text-align:center}.printcards .owner{float:right;height:40px}.printcards .ownerText{float:right;font:14pt / 1.26 NotoSans,Helvetica,Arial;margin-right:0.3em;margin-top:0.3em}.printcards .formattedid{float:left;font:14pt / 1.26 NotoSans,Helvetica,Arial;margin-left:0.25em;margin-top:0.3em}.printcards .planestimate{bottom:0.5em;position:absolute;right:0.5em}.printcards .preliminaryestimate{margin:0.25em auto 0 auto;padding-left:1.0em;bottom:0.5em;position:absolute}.printcards .content{height:2.4in;overflow:hidden;width:4.3in;color:black;padding-left:4px;padding-right:8px}.printcards body{background-color:#fff;margin:0;padding:0}.printcards .cb{clear:both}.printcards .artifact{background-color:#fff;border:2px solid #000;float:left;height:3.2in;margin:0.1in 0.1in 0.1in 0.1in;position:relative;overflow:hidden;width:4.3in}.print-page .printcards{width:920px !important;height:100% !important;overflow:hidden !important}.print-page .printcards .header{display:none}@media print{.printcards .pb{page-break-after:always;clear:both}}
    </style>
</head>
<body>
</body>
</html>
